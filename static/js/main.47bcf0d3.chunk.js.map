{"version":3,"sources":["util/makeEnum.js","const/brush.js","lib/pxls.js","util/search.js","store/config/tools.js","const/tools.js","store/config/actions.js","store/config/reducer.js","store/palette/actions.js","store/palette/reducer.js","store/canvas/actions.js","store/canvas/reducer.js","store/reducer.js","store/index.js","store/redux-localStorage.js","store/keyboard/keys.js","util/mapReduce.js","util/snek.js","util/classnames.js","components/Icon.jsx","components/Keyboard/useKeypress.js","components/Keyboard/Key.jsx","components/Keyboard/PaletteItem.jsx","components/Keyboard/Once.jsx","components/Keyboard/Tool.jsx","components/Keyboard/Select.jsx","components/Keyboard/Mode.jsx","components/Keyboard/Carousel.jsx","components/Keyboard/BrushShape.jsx","components/Keyboard/Toggle.jsx","const/toggles.js","components/Keyboard/Mirror.jsx","components/Keyboard/RotationalSymmetry.jsx","components/Keyboard/Numeric.jsx","components/Keyboard/CanvasSize.jsx","components/Keyboard/BrushSize.jsx","components/Keyboard/StrokeSize.jsx","components/Keyboard/config.js","components/Keyboard/BackgroundColor.jsx","components/Keyboard/Keys.jsx","components/Keyboard/index.jsx","lib/brush.js","components/Canvas.jsx","components/SideLength.jsx","components/FileImport.jsx","App.jsx","index.js"],"names":["makeEnum","items","reduce","o","item","s","Symbol","Modes","shapes","push","map","Shapes","Mirror","none","vertical","horizontal","both","0","1","2","3","rect","height","cx","cy","width","out","y","x","Math","floor","circle","diameter","radius","px","py","polygon","n","d","PI","h","cos","theta","abs","atan2","R","subtract","a","b","copy","Object","assign","keys","forEach","k","keyToPoint","key","split","Number","pointsToMap","points","mapPoint","I","p","mapToPoints","pxlsToColorMap","pxls","entries","pos","col","colorMapToPxls","colorMap","color","rotate90","cw","val","flip","fill","position","init","root","getNeighbors","isValid","getKey","toString","visited","queue","hits","visit","node","isVisited","length","toCheck","shift","bfs","symmetries","Tools","types","setMirror","mirror","type","payload","initialState","mode","pencil","brush","square","rotationalSymmetry","size","stroke","background","setPaletteIndex","fromPalette","palette","paletteIndex","updateItemAt","arr","index","next","slice","resize","side","setPxls","hist","hidx","removeNulls","filter","v","combineReducers","config","state","action","nextBrush","indexOf","previousBrush","nextSymmetry","previousSymmetry","tool","increaseBrushSize","decreaseBrushSize","max","paletteTypes","setPaletteColor","configTypes","nextColor","previousColor","canvas","canvasTypes","min","resetSize","bucket","setPxl","clearPxl","clearPxls","clear","increaseCanvasSize","decreaseCanvasSize","rotateClockwise","rotate","rotateCounterClockwise","flipHorizontally","flipVertically","undo","redo","includes","dehydratePxls","isColorMap","fk","rehydratePxls","defaultState","dehydrate","rehydrate","rateLimit","Persist","store","save","throttle","localStorage","setItem","JSON","stringify","getState","result","merge","parse","getItem","makePersistence","reducer","undefined","json","middleware","createStore","applyMiddleware","qwerty","call","c","toUpperCase","mapReduce","obj","cb","i","snek","str","len","toLowerCase","srs","classnames","args","Boolean","cn","join","WrappedIcon","icon","Icon","name","flipV","flipH","spin","className","code","ctrl","alt","listeners","useKeypress","callback","repeat","useEffect","Key","label","children","prependChildren","onKey","NP","onKeyShift","onKeyCtrl","onKeyAlt","isRepeatable","activeTime","rest","useState","active","setActive","useMemo","setTimeout","data-key","title","window","addEventListener","e","document","activeElement","tagName","shiftKey","ctrlKey","altKey","canRepeat","preventDefault","blur","connect","selected","dispatch","update","target","value","select","style","onClick","onChange","Once","props","activate","activateTool","upperFirst","Select","group","onSelect","checked","setMode","CarouselItem","Carousel","options","onNext","onPrevious","selectedIndex","selectedItem","find","shape","Toggle","onToggle","Toggles","uid","mirrorVertically","toggle","findIndex","degrees","Numeric","inputProps","step","decreaseProps","increaseProps","ref","useRef","focusOnKey","current","focus","disabled","doStep","dir","minSize","maxSize","stepSize","setSize","setStroke","component","inp","activatePicker","click","PaletteItem","mr","eraser","darken","lighten","dropper","invert","mix","BrushMode","Tool","mirrorHorizontally","BrushShape","RotationalSymmetry","CanvasSize","BrushSize","StrokeSize","used","cfg","flat","unused","Keys","replace","codeToLabel","Keyboard","adj","N","ceil","explode","x0","y0","rx","ry","bx","by","alpha","getBrushPositions","rs","bruhhh","center","triangle","pentagon","hexagon","octagon","squareOutline","circleOutline","triangleOutline","pentagonOutline","hexagonOutline","octagonOutline","getBrush","bMap","positions","rots","pots","angle","vx","vy","sin","rotateVector","threshold","interpolate","applyBrush","Color","hex","negate","Canvas","bg","React","createRef","cursor","handlePointerDown","bind","handlePointerUpdate","handlePointerUp","handlePointerLeave","dbPointerUp","debounce","pxlCache","_mouse","_lastMouse","this","_ctx","getContext","_bgCtx","_cursorCtx","getBoundingClientRect","_width","_height","updateCanvasProps","paintPxls","paintBg","can","cancelAnimationFrame","af","baf","maf","removeEventListener","requestAnimationFrame","paintCursor","which","_down","_moved","cancel","pxlClicked","pointerToPos","offsetX","offsetY","pointerType","apply","cols","rows","updatePxls","pointer","newPxls","paf","backgroundHatching","ctx","fillStyle","fillRect","getPxls","clearRect","clearAll","rat","brushPreview","modeIcon","mx","my","top","left","id","Component","defaultProps","setColor","getImageData","img","createElement","wid","hei","drawImage","imageDataToPxls","data","chunk","r","g","padStart","STATUS","FileImport","handleChange","handleDragEnter","status","ready","delay","setState","setStatus","waiting","se","processing","file","tar","files","Promise","resolve","reject","reader","FileReader","Image","b64","onload","src","readAsDataURL","then","Error","success","catch","error","finally","cleanupTime","waitingMessage","processingMessage","successMessage","errorMessage","accept","App","SideLength","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.47bcf0d3.chunk.js","sourcesContent":["export default function makeEnum(items) {\n  return items.reduce((o, item) => {\n    const s = Symbol(item);\n    o[item] = s;\n    o[s] = item\n    return o;\n  }, {});\n}\n","import makeEnum from '../util/makeEnum';\n\nexport const modes = [\n  'pencil',\n  'eraser',\n  'darken',\n  'lighten',\n  'invert',\n  'mix',\n  'bucket',\n  'dropper'\n];\n\nexport const Modes = makeEnum(modes);\n\nexport const shapes = [\n  'square',\n  'circle',\n  'triangle',\n  'pentagon',\n  'hexagon',\n  'octagon'\n];\n\nshapes.push(...shapes.map(s => s + 'Outline'));\n\nexport const Shapes = makeEnum(shapes);\n\nexport const Mirror = {\n  none: 0,\n  vertical: 2**0,\n  horizontal: 2**1,\n  both: 2**0 + 2**1,\n  0: \"none\",\n  1: \"vertical\",\n  2: \"horizontal\",\n  3: \"both\"\n};\n\n","import { bfs } from \"../util/search\";\n\nexport function rect([cx, cy], height, width = height) {\n  const out = [];\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      out.push([\n        Math.floor(cx - width / 2 + x),\n        Math.floor(cy - height / 2 + y),\n      ]);\n    }\n  }\n  return out;\n}\n\nexport function circle([cx, cy], diameter) {\n  const out = [],\n    radius = diameter / 2;\n  for (let y = 0; y < diameter; y++) {\n    for (let x = 0; x < diameter; x++) {\n      const px = x - radius + 1 / 2,\n        py = y - radius + 1 / 2;\n      if (px ** 2 + py ** 2 < radius ** 2)\n        out.push([Math.floor(cx - radius + x), Math.floor(cy - radius + y)]);\n    }\n  }\n  return out;\n}\n\n// TODO: figger it out 2head\nexport function polygon([cx, cy], diameter, n) {\n  const out = [],\n    radius = diameter / 2,\n    d = (2 * Math.PI) / n;\n  const h = radius * Math.cos(d / 2);\n\n  for (let y = 0; y < diameter; y++) {\n    for (let x = 0; x < diameter; x++) {\n      const px = x - radius + 1 / 2,\n        py = y - radius + 1 / 2;\n      const theta = Math.abs(\n        (((5 / 2) * Math.PI + Math.atan2(py, px)) % d) - d / 2\n      );\n      const R = h / Math.cos(theta);\n      if (px ** 2 + py ** 2 < R ** 2)\n        out.push([Math.floor(cx - radius + x), Math.floor(cy - radius + y)]);\n    }\n  }\n  return out;\n}\n\nexport function add(a, b) {\n  return Object.assign({}, a, b);\n}\n\nexport function subtract(a, b) {\n  const copy = Object.assign({}, a);\n  Object.keys(b).forEach((k) => delete copy[k]);\n  return copy;\n}\n\nexport function keyToPoint(key) {\n  return key.split(\",\").map(Number);\n}\n\nexport function pointsToMap(points, mapPoint = (I) => 1) {\n  return points.reduce((o, p) => {\n    o[p] = mapPoint(p);\n    return o;\n  }, {});\n}\nexport function mapToPoints(map) {\n  return Object.keys(map).map(keyToPoint);\n}\n\n/**\n * flattenPxls - convert pxls into flat array\n * pxls\n * width\n * height\n */\nexport function flattenPxls(pxls, width, height = width) {\n  const out = [];\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      out.push(pxls[[x, y]] || 0);\n    }\n  }\n  return out;\n}\n\n/**\n * pxlsToColorMap - convert { [position]: color } to { [color]: ]positions] }\n * pxls\n */\nexport function pxlsToColorMap(pxls) {\n  return Object.entries(pxls).reduce((o, [pos, col]) => {\n    (o[col] || (o[col] = [])).push(pos);\n    return o;\n  }, {});\n}\n\n/**\n * colorMapToPxls - convert { [color]: [positions] } to { [position]: color }\n * colorMap\n */\nexport function colorMapToPxls(colorMap) {\n  return Object.entries(colorMap).reduce(\n    (o, [color, positions]) =>\n      positions.reduce((o, p) => {\n        o[p] = color;\n        return o;\n      }, o),\n    {}\n  );\n}\n\n/**\n * rotate - rotate pxls about the center\n * pxls\n * clockwise - <true>\n * dimensions - [width, height]\n */\nexport function rotate90(pxls, cw = true, [width, height]) {\n  return Object.entries(pxls).reduce((o, [key, val]) => {\n    let [x, y] = key.split(\",\").map(Number);\n    let pos = cw ? [height - y - 1, x] : [y, width - x - 1];\n    o[pos] = val;\n    return o;\n  }, {});\n}\n\n/**\n * flip - rotate pxls about the center\n * pxls\n * vertical - <true> flip about the vertical axis (otherwise the horizontal)\n * dimensions - [width, height]\n */\nexport function flip(pxls, vertical = false, [width, height]) {\n  return Object.entries(pxls).reduce((o, [key, val]) => {\n    let [x, y] = key.split(\",\").map(Number);\n    let pos = [!vertical ? width - x - 1 : x, !vertical ? y : height - y - 1];\n    o[pos] = val;\n    return o;\n  }, {});\n}\n\n/**\n * fill - fill the contiguous area about the position with the color\n * pxls\n * position\n * color\n * dimensions - [width, height]\n */\nexport function fill(pxls, position, color, [width, height]) {\n  let init = pxls[position];\n  return bfs(\n    position,\n    ([x, y]) => [\n      [x, y - 1],\n      [x, y + 1],\n      [x - 1, y],\n      [x + 1, y],\n    ],\n    ([x, y]) =>\n      x >= 0 && x < width && y >= 0 && y < height && pxls[[x, y]] === init\n  ).reduce((o, pos) => {\n    o[pos] = color;\n    return o;\n  }, Object.assign({}, pxls));\n}\n","export function bfs (\n  root, \n  getNeighbors = () => {}, \n  isValid = () => {}, \n  getKey = o => o.toString()\n) {\n  let visited = {};\n  let queue = [root];\n  let hits = [];\n  function visit(node) {\n    visited[getKey(node)] = true;\n  }\n  function isVisited(node) {\n    return visited[getKey(node)];\n  }\n  while(queue.length) {\n    let toCheck = queue.shift();\n    if (!isVisited(toCheck) && isValid(toCheck)) {\n      hits.push(toCheck);\n      queue.push(...getNeighbors(toCheck));\n    }\n    visit(toCheck);\n  }\n  return hits;\n}\n\n\n","export const symmetries = [0, 30, 45, 60, 90, 120, 180];\n","import makeEnum from '../util/makeEnum';\n\nexport const Tools = makeEnum([\n  'flipVertically', \n  'flipHorizontally', \n  'previousColor',\n  'nextColor',\n  'rotateCounterClockwise', \n  'rotateClockwise', \n  'clear', \n  'undo',\n  'redo',\n]);\n","import makeEnum from '../../util/makeEnum';\nimport { Mirror } from '../../const/brush';\n\nexport const types = makeEnum([\n  \"mode\",\n  \"brush\",\n  \"nextBrush\",\n  \"previousBrush\",\n  \"tool\",\n  \"mirror\",\n  \"size\",\n  \"stroke\",\n  \"rotationalSymmetry\",\n  \"nextSymmetry\",\n  \"previousSymmetry\",\n  \"background\"\n]);\n\n\nexport function setBackgroundColor(color) {\n  return { type: types.background, payload: color };\n}\n\nexport function setMode(mode) {\n  return { type: types.mode, payload: mode };\n}\n\nexport function setBrush(brush) {\n  return { type: types.brush, payload: brush };\n}\n\nexport function nextBrush() {\n  return { type: types.nextBrush };\n}\n\nexport function previousBrush() {\n  return { type: types.previousBrush };\n}\nexport function activateTool(tool) {\n  return { type: types.tool, payload: tool };\n}\n\nexport function setMirror(mirror) {\n  return { type: types.mirror, payload: mirror };\n}\n\nexport function toggleMirror(name) {\n  switch (name) {\n    case \"mirror-vertically\": return setMirror(Mirror.vertical);\n    case \"mirror-horizontally\": return setMirror(Mirror.horizontal);\n    default: break;\n  }\n}\n\nexport function setSymmetry(degrees) {\n  return { type: types.rotationalSymmetry, payload: degrees };\n}\n\nexport function nextSymmetry() {\n  return { type: types.nextSymmetry };\n}\n\nexport function previousSymmetry() {\n  return { type: types.previousSymmetry };\n}\n\nexport function setSize(size) {\n  return { type: types.size, payload: size };\n}\n\nexport function resetSize() {\n  return { type: types.size, payload: 1 };\n}\n\nexport function setStroke(size) {\n  return { type: types.stroke, payload: size };\n}\n\nexport function resetStroke() {\n  return { type: types.stroke, payload: 1 };\n}\n","import { symmetries } from \"./tools\";\nimport { Mirror, Modes, Shapes, shapes } from \"../../const/brush\";\nimport { Tools } from \"../../const/tools\";\nimport { types } from \"./actions\";\n\nconst initialState = {\n  mode: Modes.pencil,\n  brush: Shapes.square, // TODO: this should be shape, not brush, maybe.\n  mirror: Mirror.none,\n  rotationalSymmetry: false,\n  size: 1,\n  stroke: 1,\n  background: \"#3b3b3b\",\n};\n\nexport default function (state = initialState, action) {\n  switch (action.type) {\n    case types.background:\n      return {\n        ...state,\n        background: action.payload,\n      };\n    case types.mirror:\n      return {\n        ...state,\n        mirror: state.mirror ^ action.payload,\n      };\n    case types.mode:\n      return {\n        ...state,\n        mode: action.payload,\n      };\n    case types.brush:\n      return {\n        ...state,\n        brush: action.payload,\n      };\n    case types.nextBrush:\n      return {\n        ...state,\n        brush:\n          Shapes[\n            shapes[(1 + shapes.indexOf(Shapes[state.brush])) % shapes.length]\n          ],\n      };\n    case types.previousBrush:\n      return {\n        ...state,\n        brush:\n          Shapes[\n            shapes[\n              (shapes.length - 1 + shapes.indexOf(Shapes[state.brush])) %\n                shapes.length\n            ]\n          ],\n      };\n    case types.size:\n      return {\n        ...state,\n        size: action.payload,\n      };\n    case types.stroke:\n      return {\n        ...state,\n        stroke: action.payload,\n      };\n    case types.rotationalSymmetry:\n      return {\n        ...state,\n        rotationalSymmetry: action.payload,\n      };\n    case types.nextSymmetry:\n      return {\n        ...state,\n        rotationalSymmetry:\n          symmetries[\n            (1 + symmetries.indexOf(state.rotationalSymmetry)) %\n              symmetries.length\n          ],\n      };\n    case types.previousSymmetry:\n      return {\n        ...state,\n        rotationalSymmetry:\n          symmetries[\n            (symmetries.length -\n              1 +\n              symmetries.indexOf(state.rotationalSymmetry)) %\n              symmetries.length\n          ],\n      };\n    case types.tool:\n      switch (action.payload) {\n        case Tools.increaseBrushSize:\n          return {\n            ...state,\n            size: state.size + 1,\n          };\n        case Tools.decreaseBrushSize:\n          return {\n            ...state,\n            size: Math.max(1, state.size - 1),\n          };\n        default:\n          break;\n      }\n      break;\n    default:\n      break;\n  }\n\n  return state;\n}\n","import makeEnum from '../../util/makeEnum';\n\nexport const types = makeEnum([\n  \"color\",\n  \"setPaletteColor\",\n  \"fromPalette\"\n]);\n\nexport function setColor(color) {\n  return { type: types.color, payload: color };\n}\nexport function setPaletteColor(index, color) {\n  return { type: types.setPaletteColor, payload: { index, color } };\n}\nexport function setPaletteIndex(n) {\n  return { type: types.fromPalette, payload: n };\n}\n\n","import { types as paletteTypes } from './actions';\nimport { types as configTypes } from '../config/actions';\nimport { Tools } from '../../const/tools';\n\nconst initialState = {\n  palette: [\"#ff0000\", \"#ffa200\", \"#eeff00\", \"#44ff00\", \"#00ffee\", \"#0400ff\", \"#a600ff\", \"#ff00ea\", \"#000000\", \"#ffffff\"],\n  paletteIndex: 0\n};\n\nfunction updateItemAt(arr, index, val) {\n  let next = arr.slice();\n  next[index] = val;\n  return next;\n}\n\nexport default function (state = initialState, action) {\n  let paletteIndex;\n  switch (action.type) {\n    case paletteTypes.color:\n      return {\n        ...state,\n        palette: updateItemAt(state.palette, state.paletteIndex, action.payload)\n      };\n    case paletteTypes.setPaletteColor:\n      return {\n        ...state,\n        paletteIndex: action.payload.index,\n        palette: updateItemAt(state.palette, action.payload.index, action.payload.color)\n      };\n    case paletteTypes.fromPalette:\n      return {\n        ...state,\n        paletteIndex: action.payload,\n      };\n    case configTypes.tool:\n      switch (action.payload) {\n        case Tools.nextColor:\n          paletteIndex = \n            (state.paletteIndex + 1) % \n            state.palette.length;\n          return {\n            ...state,\n            paletteIndex,\n          };\n        case Tools.previousColor:\n          paletteIndex = \n            (state.palette.length + state.paletteIndex - 1) % \n            state.palette.length;\n          return {\n            ...state,\n            paletteIndex,\n          };\n        default: break;\n      }\n      break;\n    default:\n      break;\n  }\n\n  return state;\n}\n","import makeEnum from '../../util/makeEnum';\n\nexport const types = makeEnum([\n  \"pixelClicked\",\n  \"resize\",\n  \"resetSize\",\n  \"bucket\",\n  \"setPxl\",\n  \"setPxls\",\n  \"clearPxl\",\n  \"clearPxls\"\n]);\n\nexport function pixelClicked(pos) {\n  return { type: types.pixelClicked, payload: pos };\n}\n\nexport function resize(side) {\n  return { type: types.resize, payload: side };\n}\n\nexport function resetSize() {\n  return { type: types.resetSize };\n}\n\nexport function bucket(position, color) {\n  return { type: types.bucket, payload: { position, color } };\n}\n\nexport function setPxl(position, color) {\n  return { type: types.setPxl, payload: { [position]: color } };\n}\n\nexport function setPxls(pxls) {\n  return { type: types.setPxls, payload: pxls };\n}\n\nexport function clearPxl(position) {\n  return { type: types.clearPxl, payload: position };\n}\n\nexport function clearPxls(positions) {\n  return { type: types.clearPxls, payload: positions };\n}\n","import { types as canvasTypes } from './actions';\nimport { types as configTypes } from '../config/actions';\nimport { Tools } from '../../const/tools';\nimport { fill, flip, rotate90 as rotate } from '../../lib/pxls';\n\n// TODO: it is said that computations shouldn't be performed in reducers...\n\n\nconst maxWidth = 256;\nconst maxHeight = 256;\nconst minWidth = 8;\nconst minHeight = 8;\n\nconst initialState = {\n  width: 24,\n  height: 24,\n  pxls: {}\n};\n\nlet hist = [];\nlet hidx = 0;\n\nfunction removeNulls(pxls) {\n  return Object.entries(pxls)\n    .filter(([_,val]) => val !== null)\n    .reduce((o, [k,v]) => {\n      o[k] = v;\n      return o;\n    }, {});\n}\nexport default function (state = initialState, action) {\n  let next;\n  switch (action.type) {\n    case canvasTypes.resize:\n      next = {\n        ...state,\n        width: Math.max(minWidth, Math.min(maxWidth, action.payload)),\n        height: Math.max(minHeight, Math.min(maxHeight, action.payload))\n      };\n      break;\n    case canvasTypes.resetSize:\n      next = {\n        ...state,\n        width: initialState.width,\n        height: initialState.height\n      };\n      break;\n    case canvasTypes.bucket:\n      next = {\n        ...state,\n        pxls: fill(\n          state.pxls, \n          action.payload.position, \n          action.payload.color, \n          [state.width, state.height]\n        )\n      };\n      break;\n    case canvasTypes.setPxl: \n      next = {\n        ...state,\n        pxls: removeNulls(Object.assign({}, state.pxls, action.payload))\n      };\n      break;\n    case canvasTypes.setPxls:\n      next = {\n        ...state,\n        pxls: removeNulls(Object.assign({}, state.pxls, action.payload))\n      };\n      break;\n    case canvasTypes.clearPxl:\n      next = {\n        ...state,\n        pxls: [action.payload].reduce(\n          (o, pos) => {\n            delete o[pos];\n            return o;\n          }, \n          Object.assign({}, state.pxls)\n        ) \n      };\n      break;\n    case canvasTypes.clearPxls:\n      next = {\n        ...state,\n        pxls: action.payload.reduce(\n          (o, pos) => {\n            delete o[pos];\n            return o;\n          }, \n          Object.assign({}, state.pxls)\n        ) \n      };\n      break;\n    // TODO: should this be a separate reducer?\n    case configTypes.tool:\n      switch (action.payload) {\n        case Tools.clear:\n          next = {\n            ...state,\n            pxls: {}\n          };\n          break;\n        case Tools.increaseCanvasSize:\n          next = {\n            ...state,\n            width: Math.min(maxWidth, state.width + 8),\n            height: Math.min(maxHeight, state.height + 8)\n          };\n          break;\n        case Tools.decreaseCanvasSize:\n          next = {\n            ...state,\n            width: Math.max(minWidth, state.width - 8),\n            height: Math.max(minHeight, state.height - 8)\n          };\n          break;\n        case Tools.rotateClockwise:\n          next = {\n            ...state,\n            pxls: rotate(state.pxls, true, [state.width, state.height])\n          };\n          break;\n        case Tools.rotateCounterClockwise:\n          next = {\n            ...state,\n            pxls: rotate(state.pxls, false, [state.width, state.height])\n          };\n          break;\n        case Tools.flipHorizontally:\n          next = {\n            ...state,\n            pxls: flip(state.pxls, false, [state.width, state.height])\n          };\n          break;\n        case Tools.flipVertically:\n          next = {\n            ...state,\n            pxls: flip(state.pxls, true, [state.width, state.height])\n          };\n          break;\n        case Tools.undo:\n          if (hidx > 0) next = hist[--hidx];\n          else return state;\n          break;\n        case Tools.redo:\n          if (hidx < hist.length - 1) next = hist[++hidx];\n          else return state;\n          break;\n        default: return state;\n      }\n      break;\n    default: return state;\n  }\n\n  if (!hist.includes(next)) {\n    if (hidx < hist.length) {\n      hist = hist.slice(0, hidx);\n    }\n    hist.push(state);\n    hidx++;\n  } else if (!hist.includes(state)) {\n    hist.push(state); \n  }\n\n  return next || state;\n}\n","import { combineReducers } from 'redux';\nimport config from './config/reducer';\nimport palette from './palette/reducer';\nimport canvas from './canvas/reducer';\n\nexport default combineReducers({\n  config,\n  palette,\n  canvas\n});\n","import { createStore, applyMiddleware } from \"redux\";\nimport makePersistence from './redux-localStorage';\nimport { Modes, Shapes } from '../const/brush';\nimport { pxlsToColorMap, colorMapToPxls } from '../lib/pxls';\n//import logger from './redux-logger';\n\nimport reducer from \"./reducer\";\n\n// TODO: investigate mapping to { [x,y,width,height]: color }\nfunction dehydratePxls(pxls, width, height = width) {\n  return pxlsToColorMap(pxls);\n}\n\nfunction isColorMap(colorMap) {\n  let fk = Object.keys(colorMap)[0];\n  return fk && fk[0] === '#';\n}\n\nfunction rehydratePxls(colorMap, width, height = width) {\n  if (!isColorMap(colorMap)) return colorMap;\n\n  return colorMapToPxls(colorMap);\n}\n\nconst [initialState, persist] = makePersistence('pxlr', {\n  defaultState: reducer(undefined, {}),\n  dehydrate: function (state) {\n    return {\n      ...state,\n      config: {\n        ...state.config,\n        mode: Modes[state.config.mode],\n        brush: Shapes[state.config.brush]\n      },\n      canvas: {\n        ...state.canvas,\n        pxls: dehydratePxls(state.canvas.pxls, state.canvas.width)\n      }\n    }\n  },\n  rehydrate: function (json) {\n    if (!json.config) return {};\n    return {\n      ...json,\n      config: {\n        ...json.config,\n        mode: Modes[json.config.mode],\n        brush: Shapes[json.config.brush]\n      },\n      canvas: {\n        ...json.canvas,\n        pxls: rehydratePxls(json.canvas.pxls, json.canvas.width)\n      }\n    }\n  }\n});\n\n// TODO: I might want to give each layer its own storage key\n\nconst middleware = [\n  //logger, \n  persist\n];\n\nexport default createStore(\n  reducer, \n  initialState, \n  applyMiddleware(...middleware)\n);\n","import merge from 'lodash/merge';\nimport throttle from 'lodash/throttle';\n\n/**\n * makePersistence - creates a redux middleware that will hydrate state on \n * initialization and dehydrate and save the global state each time \n * an action is performed (throttled by the rateLimit option)\n * key: String - they localStorage key to use\n * options: Object - configuration options\n * options.defaultState: Object <{}> - merged with the initial rehydrated state\n * options.dehydrate: Function <I=>I> - transform state before saving\n * options.rehydrate: Function <I=>I> - transform stored data before returning initial state\n * options.rateLimit: Number <1000> - rate at which to throttle saving\n */\nexport default function makePersistence(key = \"app-data\", {\n  defaultState = {}, \n  dehydrate = I=>I, \n  rehydrate = I=>I,\n  rateLimit = 1000\n}) {\n  function Persist(store) {\n    const save = throttle(() => {\n      localStorage.setItem(key, JSON.stringify(dehydrate(store.getState())));\n    }, rateLimit);\n\n    return next => action => {\n      const result = next(action);\n      save(); // It's important to do this after the actions has been performed.\n      return result;\n    };\n  }\n\n  return [\n    merge({}, defaultState, rehydrate(JSON.parse(localStorage.getItem(key)) || {})),\n    Persist\n  ];\n}\n\n","const qwerty = [\n  ...[].map.call('1234567890', d => 'Digit' + d),\n  ...[].map.call('qwertyuiopasdfghjklzxcvbnm', c => 'Key' + c.toUpperCase()),\n  'Minus',\n  'Equal',\n  'BracketLeft',\n  'BracketRight',\n  'Backslash',\n  'Semicolon',\n  'Quote',\n  'Comma',\n  'Period',\n  'Slash',\n  'Backquote',\n  'Backspace',\n  'Tab',\n  'Caps',\n  'Enter',\n  'ShiftLeft',\n  'ShiftRight',\n  'ControlLeft',\n  'ControlRight',\n  'AltLeft',\n  'AltRight',\n  'Space'\n];\n\nexport default qwerty;\n","// TODO: this is the wrong name\nexport default function mapReduce(obj, cb = I=>I) {\n  return Object.entries(obj).reduce((o, [k,v], i) => {\n    o[i] = cb(v, k, i);\n    return o;\n  }, []);\n}\n","// converts camelCase to snake-case\nexport default function snek(str) {\n  let o = '';\n  for (let i = 0, len = str.length; i < len; i++) {\n    const c = str[i].toLowerCase();\n    if (c === str[i]) o += c;\n    else o += '-' + c;\n  }\n  return o;\n}\n\n// converts camelCase to Title Case\nexport function srs(str) {\n  let o = str[0].toUpperCase();\n  for (let i = 1, len = str.length; i < len; i++) {\n    const c = str[i].toLowerCase();\n    if (c === str[i]) o += c;\n    else o += ' ' + str[i];\n  }\n  return o;\n\n}\n","export default function classnames(...args) {\n  return args.filter(Boolean).map(cn => \n    typeof cn === \"string\" ? cn:\n      Object\n        .entries(cn)\n        .filter(([,v]) => v)\n        .map(([k]) => k)\n        .join(' ')\n  ).join(' ')\n}\n","import React from 'react';\nimport cn from '../util/classnames';\n\nexport const WrappedIcon = ({ icon }) => (\n  typeof icon === \"string\"\n    ? <Icon name={icon} />\n    : typeof icon === \"object\"\n    ? <Icon {...icon} /> // TODO: safety dance\n    : false\n);\n\nexport default function Icon({ \n  name, \n  rotate = 0, \n  flipV = false, \n  flipH = false,\n  spin = false\n}) {\n  return (\n    <i \n      className={cn({\n        \"icon\": true,\n        \"mdi\": true,\n        [\"mdi-\" + name]: true,\n        [\"mdi-rotate-\" + rotate]: [45,90,135,180,225,270,315].includes(rotate),\n        \"mdi-flip-h\": flipH,\n        \"mdi-flip-v\": flipV,\n        \"mdi-spin\": spin\n      })}\n    />\n  );\n}\n","import { useEffect } from \"react\";\n\nfunction getKey(code, shift, ctrl, alt) {\n  return [shift && \"shift\", ctrl && \"ctrl\", alt && \"alt\", code]\n    .filter(Boolean)\n    .toString();\n}\nconst listeners = {};\nfunction handleKeypress(e) {\n  if (document.activeElement.tagName === \"INPUT\") {\n    if ([\"Escape\", \"Enter\", \"Return\"].includes(e.code))\n      document.activeElement.blur(); \n    return; // don't interfere with typing.\n  }\n  \n  let cb = listeners[getKey(e.code, e.shiftKey, e.ctrlKey, e.altKey)];\n  if (!cb) return; \n  \n  let canRepeat = cb.repeat;\n  if (e.repeat && !canRepeat) return; \n\n  e.preventDefault();\n  cb(e);\n}\nwindow.addEventListener(\"keydown\", handleKeypress);\n\n// TODO: there's a flaw in that this can't handle multiple callbacks for the same key\nexport default function useKeypress(\n  code,\n  callback, \n  {\n    shift = false,\n    ctrl = false,\n    alt = false,\n    repeat = false\n  } = {}\n) {\n  useEffect(() => {\n    let key = getKey(code, shift, ctrl, alt);\n    callback.repeat = repeat;\n    listeners[key] = callback;\n    return () => delete listeners[key];\n  }, [code, callback, shift, ctrl, alt, repeat]);\n}\n","import React, { useState, useMemo } from 'react';\nimport { WrappedIcon } from '../Icon';\nimport useKeypress from './useKeypress';\nimport cn from '../../util/classnames';\n\nexport default function Key({ \n  code,\n  label = code,\n  className = '',\n  icon, \n  children,\n  prependChildren = false,\n  onKey = NP => NP,\n  onKeyShift = NP => NP,\n  onKeyCtrl = NP => NP,\n  onKeyAlt = NP => NP,\n  isRepeatable = false,\n  activeTime = 250,\n  ...rest // TODO: this is usually kinda finicky\n}) {\n  const [active, setActive] = useState(false);\n  const activateOnKey = useMemo(() => {\n    return function() {\n      onKey();\n      setActive(true);\n      setTimeout(() => setActive(false), activeTime);\n    }\n  }, [activeTime, onKey]);\n  useKeypress(code, activateOnKey, { repeat: isRepeatable });\n  useKeypress(code, onKeyShift, { shift: true, repeat: isRepeatable });\n  useKeypress(code, onKeyCtrl, { ctrl: true, repeat: isRepeatable });\n  useKeypress(code, onKeyAlt, { alt: true, repeat: isRepeatable });\n  \n  return (\n    <label\n      data-key={code}\n      className={cn('key', className, active && \"activated\")} \n      title={`(${code}) ${label}`}\n      {...rest}\n    >\n      {prependChildren && children}\n      <span>{label}</span>\n      <WrappedIcon icon={icon} />\n      {!prependChildren && children}\n    </label>\n  );\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport cn from '../../util/classnames';\nimport { \n  setPaletteColor, \n  setPaletteIndex\n} from '../../store/palette/actions';\n\nimport Key from './Key';\n\nexport const PaletteItem = ({\n  code,\n  color, \n  selected, \n  update,\n  select,\n  icon = \"palette-outline\"\n}) => (\n  <Key \n    className={cn(\"color\", selected && 'selected')}\n    style={{ background: color }}\n    code={code}\n    icon={icon}\n    label={color}\n    onClick={select}\n    onKey={select}\n    prependChildren\n  >\n    <input type=\"color\" onChange={update} value={color} />\n  </Key>\n);\n\nexport default connect(\n  (state, { index }) => ({\n    color: state.palette.palette[index],\n    selected: state.palette.paletteIndex === index,\n  }),\n  (dispatch, { index }) => ({\n    update: e => dispatch(setPaletteColor(index, e.target.value)),\n    select: () => dispatch(setPaletteIndex(index))\n  }),\n)(PaletteItem);\n","import React from 'react';\nimport Key from './Key';\nimport cn from '../../util/classnames';\n\nexport default function Once({ className, onClick, ...props }) {\n  return (\n    <Key className={cn(\"once\", className)} onKey={onClick} {...props}>\n      <button onClick={onClick} />\n    </Key>\n  );\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport upperFirst from 'lodash/upperFirst';\nimport cn from '../../util/classnames';\nimport { activateTool } from '../../store/config/actions';\nimport Once from './Once';\n\nexport const Tool = ({\n  className,\n  code,\n  name,\n  icon,\n  activate\n}) => (\n  <Once\n    className={cn(\"tool\", className)}\n    label={upperFirst(name)} \n    code={code} \n    icon={icon} \n    onClick={activate} \n  />\n);\n\nexport default connect(undefined, (dispatch, { tool }) => ({\n  activate: () => dispatch(activateTool(tool))\n}))(Tool);\n","import React from 'react';\nimport cn from '../../util/classnames';\nimport Key from './Key';\n\nexport default function Select({ \n  className, \n  group, \n  onSelect, \n  selected = false, \n  ...props \n}) {\n  return (\n    <Key \n      className={cn('select', className, selected && \"selected\" )} \n      onKey={onSelect}\n      {...props}\n      prependChildren \n    >\n      <input \n        type=\"radio\" \n        name={group} \n        onChange={onSelect} \n        checked={selected} \n      />\n    </Key>\n  );\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport upperFirst from 'lodash/upperFirst';\nimport { setMode } from '../../store/config/actions';\nimport Select from './Select';\n\nexport const Mode = ({ \n  code,\n  name,\n  icon,\n  select,\n  selected\n}) => (\n  <Select\n    className=\"mode\"\n    group=\"mode\"\n    label={upperFirst(name)} \n    code={code} \n    icon={icon} \n    onSelect={select}\n    selected={selected}\n  />\n);\n\nexport default connect(\n  (state, { mode }) => ({ \n    selected: state.config.mode === mode\n  }), \n  (dispatch, { mode }) => ({\n    select: () => dispatch(setMode(mode))\n  })\n)(Mode);\n","import React from 'react';\nimport cn from '../../util/classnames';\nimport Key from './Key';\nimport { WrappedIcon } from '../Icon';\n\nfunction CarouselItem ({ value, icon, label, selected, ...rest }) {\n  return (\n    <label\n      className={cn(\"carousel-item key\", selected && \"active\")} \n      {...rest}\n    >\n      <WrappedIcon icon={icon} />\n      <span>{label}</span>\n    </label>\n  );\n}\n\nexport default function Carousel({ \n  className,\n  options,\n  onNext,\n  onPrevious,\n  select,\n  selectedIndex = 0,\n  selectedItem = options[selectedIndex] || {},\n  icon = selectedItem.icon,\n  label = selectedItem.label,\n  ...props \n}) {\n  return (\n    <Key \n      className={cn('carousel', className)} \n      icon={icon}\n      label={label}\n      onKey={onNext}\n      onKeyShift={onPrevious}\n      onKeyAlt={() => select(options[0].value)} \n      {...props}\n    > \n      { options.map((item) => ( \n        <CarouselItem\n          key={item.label}\n          selected={selectedItem === item}\n          onClick={() => select(item.value)}\n          value={item.value}\n          icon={item.icon}\n          label={item.label}\n        /> \n      ))}\n    </Key>\n  );\n}\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { nextBrush, previousBrush, setBrush } from \"../../store/config/actions\";\n\nimport Carousel from \"./Carousel\";\n\nexport const BrushShape = (props) => (\n  <Carousel className=\"brush-shape\" {...props} />\n);\n\nexport default connect(\n  (state, { options }) => ({\n    selectedItem: options.find((b) => b.value === state.config.brush),\n  }),\n  (dispatch) => ({\n    onNext: () => dispatch(nextBrush()),\n    onPrevious: () => dispatch(previousBrush()),\n    select: (shape) => dispatch(setBrush(shape)),\n  })\n)(BrushShape);\n","import React from 'react';\nimport cn from '../../util/classnames';\nimport Key from './Key';\n\nexport default function Toggle({ className, onToggle, checked, ...props }) {\n  return (\n    <Key\n      className={cn('toggle', className, checked && \"active\")} \n      onKey={onToggle}\n      {...props}\n      prependChildren \n    >\n      <input type=\"checkbox\" onChange={onToggle} checked={checked} />\n    </Key>\n  );\n}\n","import makeEnum from '../util/makeEnum';\n\nexport const Toggles = makeEnum([\n  'mirrorVertically', \n  'mirrorHorizontally' \n]);\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport upperFirst from 'lodash/upperFirst';\nimport ToggleKey from './Toggle';\n\n// TODO: get rid of the icky hacky\nimport { setMirror } from '../../store/config/actions';\nimport { Toggles } from '../../const/toggles';\n\nexport const Mirror = ({ \n  code,\n  name,\n  icon,\n  checked,\n  toggle,\n  uid\n}) => (\n  <ToggleKey\n    label={upperFirst(name)} \n    code={code} \n    icon={icon} \n    checked={checked}\n    onToggle={toggle} \n  />\n);\n\nexport default connect(\n  (state, { uid }) => ({\n    checked: uid === Toggles.mirrorVertically \n      ? state.config.mirror & 1\n      : state.config.mirror & 2\n  }), \n  (dispatch, { uid }) => ({\n    toggle: () => dispatch(setMirror(\n      uid === Toggles.mirrorVertically\n        ? 1\n        : 2\n    ))\n  })\n)(Mirror);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport cn from \"../../util/classnames\";\nimport {\n  nextSymmetry,\n  previousSymmetry,\n  setSymmetry,\n} from \"../../store/config/actions\";\n\nimport Carousel from \"./Carousel\";\n\nexport const RotationalSymmetry = (props) => (\n  <Carousel\n    className={cn(\"rotational-symmetry\", props.selectedIndex && \"active\")}\n    {...props}\n  />\n);\n\nexport default connect(\n  (state, { options }) => ({\n    selectedIndex: options.findIndex(\n      ({ value }) => value === state.config.rotationalSymmetry\n    ),\n  }),\n  (dispatch, { options }) => ({\n    onNext: () => dispatch(nextSymmetry()),\n    onPrevious: () => dispatch(previousSymmetry()),\n    select: (value) => dispatch(setSymmetry(value)),\n  })\n)(RotationalSymmetry);\n","import React, { Fragment, useRef, useMemo } from 'react';\nimport cn from '../../util/classnames';\nimport Key from './Key';\n\nexport default function Numeric({ \n  inputProps: {\n    min,\n    max,\n    step,\n    value,\n    onChange,\n    onKey, \n    ...inputProps\n  },\n  decreaseProps,\n  increaseProps,\n  ...props \n}) {\n  const ref = useRef();\n  const focusOnKey = useMemo(() => {\n    return () => {\n      ref.current && ref.current.focus();\n      onKey();\n    }\n  }, [ref, onKey]);\n\n  return (\n    <Fragment>\n      <Key \n        className={cn('numeric', 'input')} \n        onKey={focusOnKey}\n        { ...inputProps }\n      >\n        <input\n          type=\"number\"\n          ref={ref}\n          min={min}\n          max={max}\n          step={step}\n          value={value}\n          onChange={onChange}\n        /> \n      </Key>\n      <Key\n        className={cn('numeric', 'decrease')}\n        disabled={value === min}\n        { ...decreaseProps }\n      />\n      <Key\n        className={cn('numeric', 'increase')}\n        disabled={value === max}\n        { ...increaseProps }\n      />\n    </Fragment>\n  );\n}\n","import React from 'react'\nimport { connect } from 'react-redux';\nimport { \n  resetSize, \n  resize \n} from '../../store/canvas/actions';\n\nimport Numeric from './Numeric';\n\nfunction doStep(size, dir = 1, minSize = 8, maxSize = 256, stepSize = 8) {\n  return Math.max(minSize, Math.min(maxSize, size + dir * stepSize));\n}\n\nexport const CanvasSize = ({ \n  inputProps,\n  decreaseProps,\n  increaseProps\n}) => (\n  <Numeric\n    inputProps={inputProps}\n    decreaseProps={decreaseProps}\n    increaseProps={increaseProps}\n  />\n);\n\nexport default connect(\n  state => ({\n    size: state.canvas.width\n  }),\n  dispatch => ({\n    resetSize: () => dispatch(resetSize()),\n    setSize: size => dispatch(resize(size))\n  }),\n  (\n    { size }, \n    { resetSize, setSize }, \n    { \n      inputProps: { min, max, step }, \n      inputProps, \n      decreaseProps, \n      increaseProps \n    }\n  ) => ({\n    inputProps: {\n      ...inputProps,\n      value: size,\n      onKey: I=>I,\n      onKeyShift: resetSize,\n      onChange: e => setSize(+e.target.value)\n    },\n    decreaseProps: {\n      ...decreaseProps,\n      onKey: () => setSize(doStep(size, -1, min, max, step)),\n      onClick: () => setSize(doStep(size, -1, min, max, step))\n    },\n    increaseProps: {\n      ...increaseProps,\n      onKey: () => setSize(doStep(size, 1, min, max, step)),\n      onClick: () => setSize(doStep(size, 1, min, max, step))\n    }\n  })\n)(CanvasSize);\n","import React from 'react'\nimport { connect } from 'react-redux';\nimport { \n  resetSize, \n  setSize\n} from '../../store/config/actions';\n\nimport Numeric from './Numeric';\n\nfunction doStep(size, dir = 1, minSize = 8, maxSize = 256, stepSize = 8) {\n  return Math.max(minSize, Math.min(maxSize, size + dir * stepSize));\n}\n\nexport const BrushSize = ({ \n  inputProps,\n  decreaseProps,\n  increaseProps\n}) => (\n  <Numeric\n    inputProps={inputProps}\n    decreaseProps={decreaseProps}\n    increaseProps={increaseProps}\n  />\n);\n\nexport default connect(\n  state => ({\n    size: state.config.size\n  }),\n  dispatch => ({\n    resetSize: () => dispatch(resetSize()),\n    setSize: size => dispatch(setSize(size))\n  }),\n  (\n    { size }, \n    { resetSize, setSize }, \n    { \n      inputProps: { min, max, step }, \n      inputProps, \n      decreaseProps, \n      increaseProps \n    }\n  ) => ({\n    inputProps: {\n      ...inputProps,\n      value: size,\n      onKey: I=>I,\n      onKeyShift: resetSize,\n      onChange: e => setSize(+e.target.value)\n    },\n    decreaseProps: {\n      ...decreaseProps,\n      onKey: () => setSize(doStep(size, -1, min, max, step)),\n      onClick: () => setSize(doStep(size, -1, min, max, step))\n    },\n    increaseProps: {\n      ...increaseProps,\n      onKey: () => setSize(doStep(size, 1, min, max, step)),\n      onClick: () => setSize(doStep(size, 1, min, max, step))\n    }\n  })\n)(BrushSize);\n","import React from 'react'\nimport { connect } from 'react-redux';\nimport { \n  resetStroke, \n  setStroke\n} from '../../store/config/actions';\n\nimport Numeric from './Numeric';\n\nfunction doStep(size, dir = 1, minSize = 8, maxSize = 256, stepSize = 8) {\n  return Math.max(minSize, Math.min(maxSize, size + dir * stepSize));\n}\n\nexport const StrokeSize = ({ \n  inputProps,\n  decreaseProps,\n  increaseProps\n}) => (\n  <Numeric\n    inputProps={inputProps}\n    decreaseProps={decreaseProps}\n    increaseProps={increaseProps}\n  />\n);\n\nexport default connect(\n  state => ({\n    size: state.config.stroke\n  }),\n  dispatch => ({\n    resetSize: () => dispatch(resetStroke()),\n    setSize: size => dispatch(setStroke(size))\n  }),\n  (\n    { size }, \n    { resetSize, setSize }, \n    { \n      inputProps: { min, max, step }, \n      inputProps, \n      decreaseProps, \n      increaseProps \n    }\n  ) => ({\n    inputProps: {\n      ...inputProps,\n      value: size,\n      onKey: I=>I,\n      onKeyShift: resetSize,\n      onChange: e => setSize(+e.target.value)\n    },\n    decreaseProps: {\n      ...decreaseProps,\n      onKey: () => setSize(doStep(size, -1, min, max, step)),\n      onClick: () => setSize(doStep(size, -1, min, max, step))\n    },\n    increaseProps: {\n      ...increaseProps,\n      onKey: () => setSize(doStep(size, 1, min, max, step)),\n      onClick: () => setSize(doStep(size, 1, min, max, step))\n    }\n  })\n)(StrokeSize);\n","import mr from '../../util/mapReduce';\nimport snek, { srs } from '../../util/snek';\n\nimport PaletteItem from './PaletteItem';\nimport Tool from './Tool';\nimport BrushMode from './Mode';\nimport BrushShape from './BrushShape';\nimport Mirror from './Mirror';\nimport RotationalSymmetry from './RotationalSymmetry';\nimport CanvasSize from './CanvasSize';\nimport BrushSize from './BrushSize';\nimport StrokeSize from './StrokeSize';\nimport BackgroundColor from './BackgroundColor';\nimport { Modes, Shapes, shapes } from '../../const/brush';\nimport { Tools } from '../../const/tools';\nimport { Toggles } from '../../const/toggles';\n\nexport default [\n  { \n    component: BackgroundColor,\n    props: {\n      code: \"Backquote\",\n      icon: \"image\"\n    }\n  },\n  ...[].map.call('1234567890', (d, i) => ({\n    component: PaletteItem,\n    props: {\n      code: 'Digit' + d,\n      index: i\n    } \n  })),\n  ...mr({\n    'KeyQ': { mode: Modes.pencil, icon: 'pencil' },\n    'KeyW': { mode: Modes.bucket, icon: 'format-color-fill' },\n    'KeyE': { mode: Modes.eraser, icon: 'eraser-variant' },\n    'KeyA': { mode: Modes.darken, icon: {name:'brightness-6', flipH:true} },\n    'KeyS': { mode: Modes.lighten, icon: 'brightness-6' },\n    'KeyD': { mode: Modes.dropper, icon: 'eyedropper' },\n    'KeyZ': { mode: Modes.invert, icon: 'invert-colors' },\n    'KeyX': { mode: Modes.mix, icon: 'bowl-mix' }\n  }, ({ mode, icon }, code, i) => ({\n    component: BrushMode,\n    props: {\n      code,\n      icon,\n      mode,\n      name: Modes[mode]\n    }\n  })),\n  ...mr({\n    'KeyF': { tool: Tools.flipVertically, icon: 'flip-vertical' },\n    'KeyG': { tool: Tools.flipHorizontally,  icon: 'flip-horizontal'},\n    'Minus': { tool: Tools.previousColor, icon: 'arrow-left-bold', className: \"PreviousColor\" },\n    'Equal': { tool: Tools.nextColor,icon: 'arrow-right-bold', className: \"NextColor\" },\n    'KeyR': { tool: Tools.rotateCounterClockwise, icon: 'format-rotate-90'},\n    'KeyT': { tool: Tools.rotateClockwise, icon: { name: 'format-rotate-90', flipH: true } },\n    'Backspace': { tool: Tools.clear, icon: 'trash-can'},\n    'KeyU': { tool: Tools.undo, icon: 'undo'},\n    'KeyI': { tool: Tools.redo, icon: 'redo'},\n  }, ({ tool, icon, ...rest }, code, i) => ({\n    component: Tool,\n    props: {\n      tool,\n      code,\n      icon,\n      name: srs(Tools[tool]),\n      ...rest\n    }\n  })),\n  ...mr({\n    'KeyV': { toggle: Toggles.mirrorVertically, icon: 'reflect-vertical' },\n    'KeyB': { toggle: Toggles.mirrorHorizontally, icon: 'reflect-horizontal' }\n  }, ({ toggle, icon }, code, i) => ({\n    component: Mirror,\n    props: {\n      uid: toggle,\n      code,\n      icon,\n      name: srs(Toggles[toggle])\n    }\n  })),\n  {\n    component: BrushShape,\n    props: {\n      code: 'Tab',\n      options: shapes.map(s => (\n        { value: Shapes[s], icon: snek(s), label: srs(s) }\n      ))\n    }\n  },\n  {\n    component: RotationalSymmetry,\n    props: {\n      code: 'KeyC',\n      icon: 'rotate-right',\n      options: [0, 30, 45, 60, 90, 120, 180].map(value => ({\n        value,\n        label: value\n      }))\n    }\n  },\n  {\n    component: CanvasSize,\n    props: {\n      code: ['KeyP', 'BracketLeft', 'BracketRight'],\n      inputProps: {\n        code: 'KeyP',\n        label: '',\n        min: 8,\n        max: 256,\n        step: 8\n      },\n      decreaseProps: {\n        code: 'BracketLeft',\n        label: 'Smaller Image',\n        icon: 'image-size-select-small',\n        isRepeatable: false\n      },\n      increaseProps: {\n        code: 'BracketRight',\n        label: 'Bigger Image',\n        icon: 'image-size-select-large',\n        isRepeatable: false\n      }\n    }\n  },\n  {\n    component: BrushSize,\n    props: {\n      code: ['KeyL', 'Semicolon', 'Quote'],\n      inputProps: {\n        code: 'KeyL',\n        label: '',\n        min: 1,\n        step: 1,\n        max: 128\n      },\n      decreaseProps: {\n        code: 'Semicolon',\n        label: 'Smaller Brush',\n        icon: 'pencil-minus',\n        isRepeatable: true\n      },\n      increaseProps: {\n        code: 'Quote',\n        label: 'Bigger Brush',\n        icon: 'pencil-plus',\n        isRepeatable: true\n\n      }\n    }\n  },\n  {\n    component: StrokeSize,\n    props: {\n      code: ['Comma', 'Period', 'Slash'],\n      inputProps: {\n        code: 'Comma',\n        label: '',\n        min: 1,\n        step: 1,\n        max: 128\n      },\n      decreaseProps: {\n        code: 'Period',\n        label: 'Smaller Stroke',\n        icon: 'pencil-minus-outline',\n        isRepeatable: true\n\n      },\n      increaseProps: {\n        code: 'Slash',\n        label: 'Bigger Stroke',\n        icon: 'pencil-plus-outline',\n        isRepeatable: true\n\n      }\n    }\n  }\n\n\n];\n","import React, { useRef, useMemo } from 'react';\nimport { connect } from 'react-redux';\nimport { setBackgroundColor } from '../../store/config/actions';\n\nimport Key from './Key';\n\nexport const BackgroundColor = ({\n  code,\n  icon,\n  color, \n  update,\n}) => {\n  const inp = useRef();\n  const activatePicker = useMemo(() => {\n    return function() {\n      inp.current.click();\n    }\n  }, [inp]);\n\n  return (\n    <Key \n      className={\"color background-color\"}\n      style={{ color: color }}\n      code={code}\n      icon={icon}\n      onKey={activatePicker}\n      label={\"Background Color\"}\n      prependChildren\n    >\n      <input ref={inp} type=\"color\" onChange={update} value={color} />\n    </Key>\n  )\n};\n\nexport default connect(\n  state => ({\n    color: state.config.background\n  }),\n  dispatch => ({\n    update: e => dispatch(setBackgroundColor(e.target.value))\n  }),\n)(BackgroundColor);\n","import React from 'react';\nimport keys from '../../store/keyboard/keys';\nimport cfg from './config';\n\nconst used = cfg.map(k => k.props.code).flat();\nconst unused = keys.filter(k => !used.includes(k));\n\nfunction codeToLabel(code) {\n  code = code.replace(/Digit|Key/, '');\n  switch (code) {\n    case \"Backquote\": return '`';\n    case \"Minus\": return '-';\n    case \"Equal\": return '=';\n    case \"BracketLeft\": return '[';\n    case \"BracketRight\": return ']';\n    case \"Backslash\": return '\\\\';\n    case \"Semicolon\": return ';';\n    case \"Quote\": return \"'\";\n    case \"Slash\": return \"/\";\n    case \"Period\": return '.';\n    case \"Comma\": return ',';\n    default: return code;\n  }\n}\n\nexport default function Keys() {\n  return  unused.map((key, i) => (\n    <label \n      key={key} \n      className=\"key\" \n      data-key={key}\n    >\n      <span>{codeToLabel(key)}</span>\n    </label>\n  ));\n}\n","import React from 'react';\nimport Keys from './Keys';\nimport cfg from './config';\n\nimport '@mdi/font/css/materialdesignicons.min.css';\nimport './Keyboard.css';\n\nexport default function Keyboard() {\n  return (\n    <div className=\"keyboard\">\n      { cfg.map((Key, i) =>  <Key.component key={Key.props.code} {...Key.props} /> )}\n      <Keys />\n    </div>\n  );\n}\n","import { Modes, Shapes, Mirror } from '../const/brush';\nimport { \n  circle, \n  rect, \n  polygon,\n  subtract, \n  mapToPoints, \n  pointsToMap,\n  flip\n} from '../lib/pxls';\n\n\nconst adj = N => 2 * Math.ceil(1 / Math.cos(Math.PI / N));\n\nexport function getBrush(position, { size, shape, mode, stroke }) {\n  if ([Modes.bucket, Modes.dropper].includes(mode)) return [position];\n  const [x, y] = position;\n  const center = [Math.floor(x + size / 2 + 1/2), Math.floor(y + size / 2 + 1/2)];\n\n  switch (shape) {\n    case Shapes.square:\n      return rect(center, size);\n    case Shapes.circle:\n      return circle(center, size);\n    case Shapes.triangle:\n      return polygon(center, size, 3);\n    case Shapes.pentagon:\n      return polygon(center, size, 5);\n    case Shapes.hexagon:\n      return polygon(center, size, 6);\n    case Shapes.octagon:\n      return polygon(center, size, 8);\n    case Shapes.squareOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(rect(center, size)),\n          pointsToMap(rect(center, Math.max(0, size - stroke * 2)))\n        )\n      );\n    case Shapes.circleOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(circle(center, size)),\n          pointsToMap(circle(center, Math.max(0, size - stroke * 2)))\n        )\n      );\n    case Shapes.triangleOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(polygon(center, size, 3)),\n          pointsToMap(polygon(center, Math.max(0, size - stroke * adj(3)), 3))\n        )\n      );\n    case Shapes.pentagonOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(polygon(center, size, 5)),\n          pointsToMap(polygon(center, Math.max(0, size - stroke * adj(5)), 5))\n        )\n      );\n    case Shapes.hexagonOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(polygon(center, size, 6)),\n          pointsToMap(polygon(center, Math.max(0, size - stroke * adj(6)), 6))\n        )\n      );\n    case Shapes.octagonOutline:\n      return mapToPoints(\n        subtract(\n          pointsToMap(polygon(center, size, 8)),\n          pointsToMap(polygon(center, Math.max(0, size - stroke * adj(8)), 8))\n        )\n      );\n\n    default: return [position];\n  }\n\n}\n\n// adapted from matter-js\nexport function rotateVector([vx, vy], angle, [px, py] = [0, 0]) {\n  const cos = Math.cos(angle), sin = Math.sin(angle);\n  return [\n    px + (vx - px) * cos - (vy - py) * sin,\n    py + (vx - px) * sin + (vy - py) * cos\n  ]; \n}\n\n// return an array of points with opacities for a given point\nexport function explode([x, y]) {\n  // Shift the coordinates by this value to avoid dealing with zeros.\n  const shift = 4096;\n  const x0 = x + shift, y0 = y + shift;\n  const rx = x0 % 1, ry = y0 % 1;\n  const bx = Math.floor(x0) - shift, by = Math.floor(y0) - shift;\n  let p = [bx, by];\n  p.alpha = (1-rx) * (1-ry);\n  const out = [p];\n  if (rx > 0) {\n    p = [bx + 1, by];\n    p.alpha = rx * (1 - ry);\n    out.push(p);\n  }\n\n  if (ry > 0) {\n    p = [bx, by + 1];\n    p.alpha = (1 - rx) * ry;\n    out.push(p);\n  }\n\n  if (rx > 0 && ry > 0) {\n    p = [bx + 1, by + 1];\n    p.alpha = rx * ry;\n    out.push(p);\n  }\n\n  return out;\n}\n\n// TODO: moar efficient\n// TODO: threshold here might be an anti-pattern\nexport function interpolate(points, threshold = 0.5) {\n  return Object.entries(points.reduce((o, p) => {\n    return explode(p).reduce((o, p) => {\n      o[p] = (o[p] || 0) + p.alpha;\n      return o;\n    }, o);\n  }, {})).reduce((o, [p,a]) => {\n    if (a < threshold) return o;\n    let v = p.split(',').map(Number);\n    v.alpha = a; // TODO: maybe not include this?\n    o.push(v);\n    return o;\n  }, []);\n}\n\n\nexport function getBrushPositions (position, { \n  mode, \n  brush, \n  size, \n  mirror, \n  width, \n  height,\n  stroke,\n  rotationalSymmetry: rs\n}) {\n  const bruhhh = getBrush(position, { mode, size, shape: brush, stroke });\n  \n  // TODO: this is less efficient, but more elegant. hmmmm\n  const bMap = pointsToMap(bruhhh);\n  const positions = [...bruhhh]\n  if (mirror & Mirror.vertical) positions.push(...mapToPoints(\n    flip(bMap, true, [width, height])\n  )); \n  if (mirror & Mirror.horizontal) positions.push(...mapToPoints(\n    flip(bMap, false, [width, height])\n  ));\n  if (mirror === Mirror.both) positions.push(...mapToPoints(\n    flip(flip(bMap, true, [width, height]), false, [width, height])\n  ));\n \n  if (rs) {\n    const rots = [], cx = width / 2 - 1/2, cy = height / 2 - 1/2;\n    for (let theta = rs; theta < 360; theta += rs) {\n      const pots = positions.map(p => rotateVector(\n        p, \n        theta / 180 * Math.PI, \n        [cx, cy]\n      ));\n      rots.push(\n        ...interpolate(pots, .44)\n      );\n    }\n    positions.push(...rots);\n  }\n\n  return positions;\n}\n\n\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Color from 'color';\nimport debounce from 'lodash/debounce';\nimport { setColor, setPaletteIndex } from '../store/palette/actions';\nimport { setPxls, bucket } from '../store/canvas/actions';\nimport { Modes } from '../const/brush';\nimport { getBrushPositions } from '../lib/brush';\nimport \"./Canvas.css\";\nimport Icon from './Icon';\n\nfunction applyBrush(position, props) {\n  const { \n    mode,\n    color, \n    pxls\n  } = props;\n  return getBrushPositions(position, props).reduce((o, p) => {\n    switch (mode) {\n      case Modes.pencil:\n        o[p] = color;\n        break;\n      case Modes.eraser:\n        o[p] = null;\n        break;\n      case Modes.darken:\n        if (pxls[p]) o[p] = Color(pxls[p]).darken(0.1).hex();\n        break;\n      case Modes.lighten:\n        if (pxls[p]) o[p] = Color(pxls[p]).lighten(0.1).hex();\n        break;\n      case Modes.invert:\n        if (pxls[p]) o[p] = Color(pxls[p]).negate().hex();\n        break;\n      case Modes.mix:\n        if (pxls[p]) o[p] = Color(pxls[p]).mix(Color(color), 0.44).hex();\n        break;\n      default: break;\n    }\n    return o;\n  }, {});\n}\n\nexport class Canvas extends Component {\n  static defaultProps = {\n    backgroundHatching: '#777'\n  }\n  \n  constructor (props) {\n    super(props);\n    this.bg = React.createRef();\n    this.canvas = React.createRef();\n    this.cursor = React.createRef();\n    this.mode = React.createRef();\n\n    this.handlePointerDown = this.handlePointerDown.bind(this);\n    this.handlePointerUpdate = this.handlePointerUpdate.bind(this);\n    this.handlePointerUp = this.handlePointerUp.bind(this);\n    this.handlePointerLeave = this.handlePointerLeave.bind(this);\n\n    this.dbPointerUp = debounce(this.handlePointerUp, 250);\n\n    this.pxlCache = {};\n    this._mouse = null;\n    this._lastMouse = null;\n  }\n\n  updateCanvasProps() {\n    this._ctx = this.canvas.current.getContext('2d');\n    this._bgCtx = this.bg.current.getContext('2d');\n    this._cursorCtx = this.cursor.current.getContext('2d');\n    const { width, height } = this.canvas.current.getBoundingClientRect();\n    this._width = width;\n    this._height = height;\n  }\n\n  componentDidMount() {\n    this.updateCanvasProps();\n    this.paintPxls();\n    this.paintBg();\n\n    const can = this.canvas.current;\n    can.addEventListener(\"pointerdown\", this.handlePointerDown);\n    can.addEventListener(\"pointerrawupdate\", this.handlePointerUpdate);\n    can.addEventListener(\"pointerup\", this.handlePointerUp);\n    can.addEventListener(\"pointerleave\", this.handlePointerLeave);\n  }\n  componentWillUnmount() {\n    cancelAnimationFrame(this.af);\n    cancelAnimationFrame(this.baf);\n    cancelAnimationFrame(this.maf);\n    \n    const can = this.canvas.current;\n    can.removeEventListener(\"pointerdown\", this.handlePointerDown);\n    can.removeEventListener(\"pointerrawupdate\", this.handlePointerUpdate);\n    can.removeEventListener(\"pointerup\", this.handlePointerUp);\n    can.removeEventListener(\"pointerleave\", this.handlePointerLeave);\n  }\n  componentDidUpdate({ size, pxls, width, mode, brush, mirror, background }) {\n    if (width !== this.props.width || pxls !== this.props.pxls) {\n      cancelAnimationFrame(this.af);\n      this.af = requestAnimationFrame(() => this.paintPxls());\n    }\n    \n    if (width !== this.props.width || background !== this.props.background) {\n      cancelAnimationFrame(this.baf);\n      this.baf = requestAnimationFrame(() => this.paintBg());\n    }\n\n    // TODO: may need to revisit this\n    this.paintCursor(true)\n  }\n\n  handlePointerDown (e) {\n    if (e.which === 3) return; // right click\n    this._down = true;\n    this._moved = false;\n  }\n  handlePointerUp (e) {\n    if (!this._down) return; // click outside of canvas\n\n    this.dbPointerUp.cancel();\n   \n    if (!this._moved || this.props.mode === Modes.dropper) {\n      this.props.pxlClicked(\n        this.pointerToPos([e.offsetX, e.offsetY]), \n        this.props\n      ); \n    }\n    else {\n      this.update();\n    }\n\n    this._moved = this._down = false;\n  }\n  handlePointerUpdate (e) {\n    if (e.pointerType === \"touch\") this.dbPointerUp(e);\n\n    this._mouse = [e.offsetX, e.offsetY];\n    this._moved = true;\n    if (this._down && e.target === this.canvas.current) \n      this.apply([e.offsetX, e.offsetY], true);\n\n    cancelAnimationFrame(this.maf);\n    this.maf = requestAnimationFrame(() => this.paintCursor());\n  }\n  handlePointerLeave (e) {\n    this._mouse = null;\n    this.paintCursor();\n  }\n\n  pointerToPos ([ offsetX, offsetY ]) {\n    const { \n      width: cols, \n      height: rows,\n      mode,\n      size\n    } = this.props;\n    const isSinglePixelMode = [Modes.bucket, Modes.dropper].includes(mode);\n    const s = isSinglePixelMode ? 1 : size;\n    return [\n      Math.floor(offsetX / this._width * cols - s/2),\n      Math.floor(offsetY / this._height * rows - s/2)\n    ];\n  }\n\n  update () {\n    this.props.updatePxls(this.pxlCache, this.props);\n    this.pxlCache = {};\n  }\n  \n  apply (pointer, multi = false) {\n    const pos = this.pointerToPos(pointer);\n    const newPxls = applyBrush(pos, this.props);\n    \n    this.pxlCache = Object.assign(\n      {}, \n      this.pxlCache, \n      newPxls\n    );\n    \n    cancelAnimationFrame(this.paf);\n    this.paf = requestAnimationFrame(() => this.paintPxls(this.pxlCache));\n  }\n  getPxls() {\n    return Object.assign({}, this.props.pxls, this.pxlCache)\n  }\n\n  paintBg() {\n    const { width, height, background, backgroundHatching } = this.props;\n    const ctx = this._bgCtx;\n\n    ctx.fillStyle = background;\n    ctx.fillRect(0, 0, width, height);\n    ctx.fillStyle = Color(backgroundHatching).alpha(.25);\n    for (let y = 0; y < width; y++) {\n      for (let x = 0; x < height; x++) {\n        if ((x % 2) + (y % 2) === 1) { \n          ctx.fillRect(x, y, 1, 1);\n        }\n      }\n    }\n  }\n\n  paintPxls(newPxls) {\n    const { width, height } = this.props; \n    const pxls = newPxls || this.getPxls();\n    const ctx = this._ctx;\n\n    if (!newPxls) ctx.clearRect(0, 0, width, height);\n    \n    Object.entries(pxls).forEach(([pos, color]) => {\n      let [x, y] = pos.split(',').map(Number);\n      if (!color) return ctx.clearRect(x, y, 1, 1);\n      ctx.fillStyle = color;\n      ctx.fillRect(x, y, 1, 1);\n    });\n  }\n\n  paintCursor(clearAll) {\n    const {\n      width, \n      size, \n      mode, \n      background, \n      backgroundHatching\n    } = this.props;\n    const bg = Color(backgroundHatching);\n    const ctx = this._cursorCtx;\n    const rat = this._width / width;\n    const brushPreview = ![Modes.bucket, Modes.dropper].includes(mode);\n    const s = brushPreview ? size * rat : rat;\n\n    if (!clearAll && this._lastMouse) {\n      if (brushPreview) {\n        let pos = this.pointerToPos(this._lastMouse)\n        getBrushPositions(pos, this.props)\n          .forEach(([x,y]) => \n            ctx.clearRect(x, y, 1, 1)\n          );\n      }\n    } else ctx.clearRect(0, 0, width, width);\n\n    if (this._mouse) {\n      this._lastMouse = this._mouse;\n\n      const pos = this.pointerToPos(this._mouse); \n      const [x, y] = pos.map(c => c * rat);\n\n      if (brushPreview) {\n        Object.entries(applyBrush(pos, this.props))\n          .forEach(([pos, color]) => {\n            const [x,y] = pos.split(',').map(Number);\n            if (color) ctx.fillStyle = color;\n            else if (mode === Modes.eraser) {\n              ctx.fillStyle = background;\n              if ((x % 2) + (y % 2) === 1) {\n                ctx.fillRect(x, y, 1, 1);\n                ctx.fillStyle = bg.alpha(.25);\n              }\n            }\n            else ctx.fillStyle = bg.alpha(.5);\n            \n            ctx.fillRect(x, y, 1, 1);\n        });\n      }\n      \n      // TODO: move this to its own component\n      const modeIcon = this.mode.current;\n      const [mx, my] = [x,y];//this._mouse;\n      modeIcon.style.top = my + 'px';\n      modeIcon.style.left = mx + 'px';\n      modeIcon.style.width = s + 'px';\n      modeIcon.style.height = s + 'px';\n\n      if (mode === Modes.dropper) {\n        modeIcon.style.background = this.props.pxls[pos] || '';\n      } else {\n        modeIcon.style.background = '';\n      }\n    }\n  }\n\n  render () {\n    const { width, height, mode } = this.props;\n    let modeIcon;\n    switch (mode) {\n      case Modes.pencil: modeIcon = 'pencil';break;\n      case Modes.bucket: modeIcon = 'format-color-fill'; break;\n      case Modes.eraser: modeIcon = 'eraser-variant'; break;\n      case Modes.darken: modeIcon = 'brightness-6 mdi-flip-h'; break;\n      case Modes.lighten: modeIcon = 'brightness-6'; break;\n      case Modes.dropper: modeIcon = 'eyedropper'; break;\n      case Modes.invert: modeIcon = 'invert-colors'; break;\n      case Modes.mix: modeIcon = 'bowl-mix'; break;\n      default: break;\n    }\n    return (\n      <div id=\"container\">\n        <canvas\n          id=\"background\"\n          ref={this.bg}\n          width={width}\n          height={height}\n        />\n        <canvas\n          id=\"canvas\"\n          ref={this.canvas}\n          width={width}\n          height={height}\n        />\n        <canvas\n          id=\"cursor\"\n          ref={this.cursor}\n          width={width}\n          height={height}\n        />\n        <span id=\"mode\" className={Modes[mode]}  ref={this.mode}>\n          <Icon name={modeIcon} />\n        </span>\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    ...state.canvas,\n    ...state.config,\n    ...state.palette,\n    color: state.palette.palette[state.palette.paletteIndex]\n  }),\n  dispatch => ({\n    pxlClicked: function(position, props) { \n      const {\n        mode,\n        color, \n        palette,\n        pxls\n      } = props;\n      \n      switch (mode) {\n        case Modes.pencil:\n        case Modes.eraser:\n        case Modes.darken:\n        case Modes.lighten:\n        case Modes.invert:\n        case Modes.mix:\n          return dispatch(setPxls(applyBrush(position, props)));\n\n        case Modes.dropper:\n          if (pxls[position]) {\n            // Switch to the color already in the palette\n            // instead of changing the current color\n            if (palette.includes(pxls[position])) {\n              return dispatch(setPaletteIndex(palette.indexOf(pxls[position])));\n            }\n            \n            return dispatch(setColor(pxls[position]));\n          }\n          break;\n        case Modes.bucket:\n          return dispatch(bucket(position, color));\n\n        default: break;\n      }\n    },\n    updatePxls: function(pxls) {\n      dispatch(setPxls(pxls));\n    }\n  })\n)(Canvas);\n","import React from 'react';\nimport { connect } from 'react-redux';\n\nexport default connect(\n  state => ({\n    width: state.canvas.width,\n    height: state.canvas.height\n  })\n)(({ width, height }) => (\n  <div className=\"side-length\">\n    <span>{ width }</span>\n  </div>\n));\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport chunk from \"lodash/chunk\";\nimport makeEnum from \"../util/makeEnum\";\nimport cn from \"../util/classnames\";\nimport { setPxls, resize } from \"../store/canvas/actions\";\nimport \"./FileImport.css\";\n\nfunction getImage(file) {\n  return new Promise((resolve, reject) => {\n    try {\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", function () {\n        const img = new Image();\n        const b64 = this.result;\n        img.onload = () => resolve(img);\n        img.src = b64;\n      });\n\n      reader.readAsDataURL(file);\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\nfunction getImageData(img) {\n  let can = document.createElement(\"canvas\"),\n    ctx = can.getContext(\"2d\"),\n    wid = img.width,\n    hei = img.height;\n  can.width = wid;\n  can.height = hei;\n  ctx.drawImage(img, 0, 0, wid, hei);\n  return ctx.getImageData(0, 0, wid, hei);\n}\n\nfunction imageDataToPxls({ data, width, height }) {\n  return chunk(data, 4).reduce((o, [r, g, b, a], i) => {\n    let x = i % width,\n      y = Math.floor(i / width);\n    if (a === 0) return o;\n\n    o[[x, y]] = [r, g, b, a].reduce(\n      (o, v) => o + v.toString(16).padStart(2, \"0\"),\n      \"#\"\n    );\n    return o;\n  }, {});\n}\n\nfunction validateSize(size) {\n  return function (img) {\n    if (img.width > size)\n      throw new Error(\"The size of the image is too damn high!\");\n    return img;\n  };\n}\n\nconst STATUS = makeEnum([\"ready\", \"waiting\", \"processing\", \"error\", \"success\"]);\n\nexport class FileImport extends Component {\n  static defaultProps = {\n    waitingMessage: \"Drop your file here.\",\n    processingMessage: \"Processing your file.\",\n    successMessage: \"Successfully processed.\",\n    errorMessage: \"There was an error while processing your file.\",\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleDragEnter = this.handleDragEnter.bind(this);\n\n    this.state = { status: STATUS.ready };\n  }\n\n  setStatus(status, delay = 0) {\n    if (delay) setTimeout(this.setState.bind(this, { status }), delay);\n    else this.setState({ status });\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"dragenter\", this.handleDragEnter);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"dragenter\", this.handleDragEnter);\n  }\n\n  handleDragEnter(e) {\n    this.setStatus(STATUS.waiting);\n  }\n\n  handleChange(se) {\n    this.setStatus(STATUS.processing);\n\n    // TODO: maybe make this a generic component some day?\n    let tar = se.target; // needt his ref to clear the value later.\n    let cleanupTime = 400;\n    let postCleanupTime = 1200;\n    getImage(tar.files[0])\n      .then(validateSize(256))\n      .then(getImageData)\n      .then((img) => {\n        this.props.resize(img.width);\n        return img;\n      })\n      .then(imageDataToPxls)\n      .then(this.props.setPxls)\n      .then(() => this.setStatus(STATUS.success, cleanupTime))\n      .catch((e) => this.setStatus(STATUS.error, cleanupTime))\n      .finally(() => {\n        tar.value = \"\";\n        this.setStatus(STATUS.ready, cleanupTime + postCleanupTime); // TODO: icky hacky\n      });\n  }\n\n  render() {\n    const { waitingMessage, processingMessage, successMessage, errorMessage } =\n      this.props;\n\n    return (\n      <label\n        className={cn({\n          \"file-import\": true,\n          [STATUS[this.state.status]]: true,\n        })}\n      >\n        <section className=\"waiting-msg\">{waitingMessage}</section>\n\n        <section className=\"processing-msg\">{processingMessage}</section>\n\n        <section className=\"success-msg\">{successMessage}</section>\n\n        <section className=\"error-msg\">{errorMessage}</section>\n\n        <input\n          onChange={this.handleChange}\n          accept=\"image/*\" // TODO: this should maybe be a prop?\n          type=\"file\"\n        />\n      </label>\n    );\n  }\n}\n\nexport default connect(null, (dispatch) => ({\n  setPxls: (pxls) => dispatch(setPxls(pxls)),\n  resize: (size) => dispatch(resize(size)),\n}))(FileImport);\n","import React from 'react';\nimport { Provider } from 'react-redux';\nimport store from './store';\n\nimport Keyboard from './components/Keyboard/';\nimport Canvas from './components/Canvas';\nimport SideLength from './components/SideLength';\nimport FileImport from './components/FileImport';\n\nexport default function App(props) {\n  return (\n    <Provider store={store}>\n      <Keyboard />\n      <span className=\"save-notice\">(right click on the image to save it)</span>\n      <Canvas />\n      <SideLength />\n      <FileImport \n        waitingMessage=\"Present your sacrifice...\"\n        processingMessage=\"Consuming...\"\n        successMessage=\"Delicious!\"\n        errorMessage=\"Disgusting!\"\n      />\n    </Provider>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}